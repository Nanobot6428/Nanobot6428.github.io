{% assign rate = site.data.services.hourly_rate %}
{% assign fixed_charge = site.data.services.fixed_charge | default: 0 %}

{% assign ext_size_ratio = site.data.services.ratios.exterior[include.size.key] %}
{% assign int_size_ratio = site.data.services.ratios.interior[include.size.key] %}

{% assign ext_time_base = site.data.services.times.exterior[include.ext_key] %}
{% assign int_time_base = site.data.services.times.interior[include.int_key] %}
{% assign ext_cost_base = site.data.services.costs.exterior[include.ext_key] %}
{% assign int_cost_base = site.data.services.costs.interior[include.int_key] %}

{% assign ext_time_scaled = ext_time_base | times: ext_size_ratio %}
{% assign int_time_scaled = int_time_base | times: int_size_ratio %}
{% assign total_time = ext_time_scaled | plus: int_time_scaled %}

{% assign ext_labour = ext_time_base | times: rate | times: ext_size_ratio %}
{% assign ext_chems  = ext_cost_base | times: ext_size_ratio %}
{% assign ext_total  = ext_labour | plus: ext_chems %}

{% assign int_labour = int_time_base | times: rate | times: int_size_ratio %}
{% assign int_chems  = int_cost_base | times: int_size_ratio %}
{% assign int_total  = int_labour | plus: int_chems %}

{% assign full_price = ext_total | plus: int_total | plus: fixed_charge %}
{% assign discounted = full_price | times: 0.85 %}

<style>
/* Service card layout */
.service-card {
  display:flex;
  flex-wrap:nowrap;
  align-items:center;
  gap:8px;
  border-bottom:1px solid #eee;
  padding:0.5rem 0;
  width:100%;
  box-sizing:border-box;
}

.service-card > .service-col   { flex:1 1 200px; font-weight:bold; word-break:break-word; }
.service-card > .time-col      { flex:0 0 80px; text-align:center; white-space:nowrap; }
.service-card > .price-col     { flex:0 0 80px; text-align:center; white-space:nowrap; }
.service-card > .loyalty-col   { flex:0 0 100px; text-align:center; color:#28a745; font-weight:bold; white-space:nowrap; }
.service-card > .book-col      { flex:0 0 100px; text-align:center; }

/* Responsive: on narrow screens, push Service full width */
@media (max-width: 600px) {
  .service-card { flex-wrap:wrap; }
  .service-card > .service-col { flex:1 1 100%; }
}

/* Info button */
.info-btn {
  padding:0.2rem 0.5rem;
  background:#6c757d;
  color:#fff;
  border:none;
  border-radius:4px;
  cursor:pointer;
  font-size:0.8rem;
}

/* Modal overlay */
#serviceModal {
  display:none;
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.6);
  z-index:9999;
  align-items:center;
  justify-content:center;
}

/* Modal box */
#serviceModal .modal-box {
  background:#fff;
  padding:1.5rem;
  border-radius:8px;
  max-width:500px;
  width:90%;
  position:relative;
}

/* Close button */
#serviceModal .close-btn {
  position:absolute;
  top:0.5rem;
  right:0.75rem;
  cursor:pointer;
  font-size:1.2rem;
  font-weight:bold;
}
</style>


<div class="service-card"
     data-category="{{ include.category }}"
     data-exterior="{{ include.ext_key }}"
     data-interior="{{ include.int_key }}"
     data-size="{{ include.size.key }}"
     data-time="{{ total_time | ceil }}"
     data-price="{{ full_price | round }}">
  <!-- Service -->
  <div class="service-col">
    {{ include.size.name }}
    {% if include.category == "exterior" %} {{ include.ext_key | capitalize }} Exterior
    {% elsif include.category == "valet" %} {{ include.ext_key | capitalize }} Valet
    {% elsif include.category == "mixed" %} {{ include.ext_key | capitalize }} Exterior + {{ include.int_key | capitalize }} Interior
    {% elsif include.category == "interior" %} {{ include.int_key | capitalize }} Interior
    {% endif %}
  </div>

  <div class="info-btn">
  {% assign desc = "" %}
  {% if include.category == "exterior" %}
    {% assign desc = site.data.services.descriptions.exterior[include.ext_key] %}
  {% elsif include.category == "valet" %}
    {% assign desc = site.data.services.descriptions.exterior[include.ext_key] 
        | append: " + " 
        | append: site.data.services.descriptions.interior[include.int_key] %}
  {% elsif include.category == "mixed" %}
    {% assign desc = site.data.services.descriptions.exterior[include.ext_key] | append: " / " | append: site.data.services.descriptions.interior[include.int_key] %}
  {% elsif include.category == "interior" %}
    {% assign desc = site.data.services.descriptions.interior[include.int_key] %}
  {% endif %}

  {% if desc %}
    <button onclick="openServiceModal(`{{ desc | escape }}`)"
            style="padding:0.2rem 0.5rem;background:#6c757d;color:#fff;
                   border:none;border-radius:4px;cursor:pointer;font-size:0.8rem;">
      i
    </button>
  {% endif %}
</div>

  <!-- Time -->
  <div class="time-col">
    {{ total_time | round:1 }} hrs
  </div>

  <!-- Price -->
  <div class="price-col">
    £{{ full_price | round }}
  </div>

  <!-- Loyalty -->
  <div class="loyalty-col">
    £{{ discounted | round }}
  </div>

  <!-- Book -->
  <div class="book-col">
    <button data-cal-link="rwmvaleting/{{ include.size.key }}-{{ include.ext_key }}-{{ include.int_key }}"
            style="width:100%;padding:0.35rem 0.5rem;background:#0078d4;color:#fff;
                   border:none;border-radius:4px;cursor:pointer;white-space:nowrap;">
      Book
    </button>
  </div>
</div>
